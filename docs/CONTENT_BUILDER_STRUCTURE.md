# Content Builder Structure

> **Purpose:** This document defines the standard structure for liturgical scripts generated by content builders in Outward Sign.

---

## Table of Contents

- [Overview](#overview)
- [Standard Section Types](#standard-section-types)
  - [Cover Page](#cover-page)
  - [Reading Page](#reading-page)
  - [Psalm Page](#psalm-page)
  - [Petitions](#petitions)
  - [Announcements](#announcements)
  - [Ceremony](#ceremony)
- [Page Break Rules](#page-break-rules)
- [Section Order](#section-order)
- [Implementation](#implementation)

---

## Overview

All liturgical scripts (Weddings, Funerals, Masses, Baptisms, Presentations, Quinceañeras) follow a consistent structure with standardized section types. This ensures:

- **Consistency** across all modules
- **Familiarity** for priests, deacons, and ministers
- **Print-friendly** formatting with proper page breaks
- **Reusable** builder components

Each liturgical script is composed of one or more of the following section types, assembled in a logical order.

---

## Standard Section Types

### Cover Page

**Purpose:** Summary page with key information about the celebration.

**Structure:**
```
Cover Page
├── Title (e.g., "Wedding Celebration")
├── Subtitle (e.g., "John Smith and Jane Doe")
└── Cover Page Section(s)
    ├── Section Title (e.g., "Sacred Liturgy", "Participants")
    └── Content (label-value pairs)
        ├── Label: Value (e.g., "Date: July 15, 2025")
        ├── Label: Value (e.g., "Location: St. Mary's Church")
        └── Label: Value (e.g., "Presider: Fr. John Doe")
```

**Components:**
- **Title** - Main heading (e.g., "Wedding Celebration", "Funeral Liturgy")
- **Subtitle** - Secondary heading (e.g., names of bride/groom, deceased person)
- **Cover Page Sections** - One or more grouped sections
  - **Section Title** - Heading for the group (e.g., "Sacred Liturgy", "Ministers")
  - **Content** - Label-value pairs presenting key information

**Example Cover Page Sections:**
- Wedding: "Wedding Celebration", "Sacred Liturgy", "Ministers"
- Funeral: "Funeral Information", "Sacred Liturgy", "Ministers"
- Mass: "Mass Information", "Ministers", "Readings"
- Baptism: "Baptism Celebration", "Child to be Baptized", "Parents", "Sponsors"

**Builder:** `buildCoverPage()` or `buildSimpleCoverPage()`

---

### Reading Page

**Purpose:** Scripture reading proclamation (First Reading, Second Reading, Gospel).

**Structure:**
```
Reading Page
├── Reading Title (e.g., "First Reading", "Second Reading", "Gospel")
├── Reading Name (e.g., "Romans 3:11-12", "John 3:16-21")
├── Name of Reader (e.g., "Reader: John Doe")
│   Note: Gospel always shows "Gospel" or "Deacon/Priest" (never a lay reader)
└── Reading Text
    ├── Introduction (e.g., "A reading from the Letter of Saint Paul to the Romans")
    ├── Body (the Scripture passage itself)
    └── Conclusion (e.g., "The word of the Lord." / "The Gospel of the Lord.")
```

**Components:**
- **Reading Title** - Type of reading (First Reading, Second Reading, Gospel)
- **Reading Name** - Scripture citation (book, chapter, verses)
- **Reader Name** - Who proclaims it
  - First/Second Reading: Lay reader name (e.g., "Reader: Jane Smith")
  - Gospel: "Gospel" or "Deacon/Priest" (never a lay reader)
- **Reading Text**
  - **Introduction** - Liturgical formula introducing the passage
  - **Body** - The Scripture passage
  - **Conclusion** - Liturgical closing formula

**Builder:** `buildReadingSection()`

**See:** [DEFINITIONS.md](./DEFINITIONS.md) for explanation of Reader vs Gospel proclamation

---

### Psalm Page

**Purpose:** Responsorial Psalm between readings.

**Structure:**
```
Psalm Page
├── Psalm Title (e.g., "Responsorial Psalm")
├── Psalm Name (e.g., "Psalm 24:1,4,5")
├── Name of Reader (e.g., "Reader: John Doe" or "Cantor: Jane Smith")
└── Psalm Text
    ├── Psalm Introduction (e.g., "R. This is the day the Lord has made; let us rejoice and be glad.")
    ├── Refrain (e.g., "R. This is the day the Lord has made")
    └── Verses (psalm verses with responses)
```

**Components:**
- **Psalm Title** - "Responsorial Psalm" or "Psalm"
- **Psalm Name** - Psalm citation (psalm number and verses)
- **Reader/Cantor Name** - Who leads the psalm
- **Psalm Text**
  - **Introduction** - First response that the assembly will repeat
  - **Refrain** - Abbreviated response (R.)
  - **Verses** - Psalm verses with response indicators

**When to Print:**
- **Print:** When psalm is recited/read (not sung)
- **Omit:** When psalm is sung (common at Sunday Masses)

**Builder:** `buildPsalmSection()`

---

### Petitions

**Purpose:** Prayers of the Faithful (General Intercessions).

**Structure:**
```
Petitions
├── Petitions Title (e.g., "Petitions", "Prayers of the Faithful")
├── Name of Reader (e.g., "Reader: John Doe")
└── Petitions Text
    ├── Petition Introduction (e.g., "For the Church..., we pray to the Lord.")
    │   Response: "Lord, hear our prayer."
    └── Individual Petitions (using petition builder)
        ├── Petition 1 (e.g., "For John and Jane, that their marriage...")
        ├── Petition 2 (e.g., "For their families...")
        ├── Petition 3 (e.g., "For all married couples...")
        └── ...
```

**Components:**
- **Petitions Title** - "Petitions" or "Prayers of the Faithful"
- **Reader Name** - Who proclaims the petitions
- **Petitions Text**
  - **Introduction** - First petition showing the response pattern
  - **Individual Petitions** - Each petition with automatic response formatting

**Builder:** `buildPetitionsSection()` or `buildPetitionsFromArray()`

---

### Announcements

**Purpose:** Parish announcements before the final blessing.

**Structure:**
```
Announcements
├── Announcements Title (e.g., "Announcements")
└── Announcements Text
    ├── Announcement 1 (e.g., "Please join us for refreshments in the hall...")
    ├── Announcement 2 (e.g., "Next week's second collection...")
    └── ...
```

**Components:**
- **Announcements Title** - "Announcements"
- **Announcements Text** - List of announcements (plain text or formatted list)

**When to Include:**
- Mass liturgies (common)
- Other celebrations (as needed)

**Builder:** Built as simple text sections or using ceremony builder

---

### Ceremony

**Purpose:** Flexible section for any ceremonial content (prayers, blessings, vows, rites).

**Structure:**
```
Ceremony
└── Content of the Ceremony
    ├── Rubrics (instructions in italics/red)
    ├── Priest Dialogue (priest's words)
    ├── Responses (assembly/participant responses)
    ├── Prayers (prayers with "Amen" response)
    ├── Actions (ritual actions)
    └── ... (any liturgical element)
```

**Components:**
Highly flexible - can include any combination of:
- **Rubrics** - Liturgical instructions (e.g., "The priest extends his hands")
- **Priest Dialogue** - Words spoken by presider
- **Responses** - Participant or assembly responses
- **Prayers** - Prayer texts (often ending with "Amen")
- **Actions** - Ritual actions described
- **Question Series** - Q&A format (e.g., marriage consent, baptismal promises)
- **Blessings** - Nuptial blessing, final blessing, etc.

**Common Ceremony Sections:**
- Wedding: Marriage Consent, Exchange of Rings, Nuptial Blessing
- Funeral: Final Commendation, Song of Farewell
- Baptism: Baptismal Promises, Baptism with Water
- Quinceañera: Renewal of Baptismal Promises, Blessing, Presentation of Symbols
- Presentation: Presentation Rite, Act of Thanksgiving

**Builder:** `buildCeremonySection()` with helper functions:
- `buildQuestionSeries()` - Q&A pattern
- `buildPrayerWithAmen()` - Prayer + Amen response
- `buildDialogueExchange()` - Single Q&A exchange
- `buildRubricAction()` - Rubric + action

**See:** `src/lib/content-builders/shared/builders/README.md` for complete builder documentation

---

## Page Break Rules

**CRITICAL RULE:** All sections have a page break after them, **except for the last section** in the script.

### Implementation

```typescript
// ✅ CORRECT - All sections get pageBreakAfter: true except the last one
const sections = [
  buildCoverPage({ /* ... */ pageBreakAfter: true }),      // Page break
  buildReadingSection({ /* ... */ pageBreakAfter: true }), // Page break
  buildReadingSection({ /* ... */ pageBreakAfter: true }), // Page break
  buildPsalmSection({ /* ... */ pageBreakAfter: true }),   // Page break
  buildReadingSection({ /* ... */ pageBreakAfter: true }), // Page break (Gospel)
  buildPetitionsSection({ /* ... */ pageBreakAfter: true }), // Page break
  buildCeremonySection({ /* ... */ pageBreakAfter: false }), // NO page break (last section)
]
```

### Why?

- **Proper pagination** - Each major section starts on a new page
- **Readability** - Clear separation between sections
- **Print-friendly** - Ministers can easily flip between sections
- **No blank last page** - Last section doesn't create an empty trailing page

### Pattern in Templates

Most templates follow this pattern at the end:

```typescript
export function buildWeddingLiturgy(wedding: WeddingWithRelations): LiturgyDocument {
  const sections = [
    // ... all sections
  ]

  // Set page breaks: all sections except the last one
  sections.forEach((section, index) => {
    if (index < sections.length - 1) {
      section.pageBreakAfter = true
    } else {
      section.pageBreakAfter = false
    }
  })

  return {
    sections,
    metadata: { /* ... */ }
  }
}
```

---

## Section Order

Standard order for a full liturgical celebration (Mass or similar):

### 1. Cover Page
Summary information and key details

### 2. Liturgy of the Word
- **First Reading** (Old Testament or Acts)
- **Responsorial Psalm** (if recited, not sung)
- **Second Reading** (New Testament letters)
- **Gospel** (Matthew, Mark, Luke, or John)

### 3. Petitions
Prayers of the Faithful

### 4. Ceremony Sections
Varies by celebration type:
- **Wedding:** Marriage Consent, Exchange of Rings, Nuptial Blessing
- **Funeral:** Final Commendation, Song of Farewell
- **Baptism:** Baptismal Promises, Baptism with Water
- **Quinceañera:** Renewal of Promises, Blessing, Presentation of Symbols

### 5. Announcements (if applicable)
Parish announcements before final blessing

### Variations

**Summary-Only (Baptism):**
- Cover Page only
- No full liturgy sections

**Mass (simplified):**
- Cover Page
- Readings (if specified)
- Petitions
- Announcements

**Full Ceremonial (Wedding, Funeral, Quinceañera):**
- Cover Page
- Full Liturgy of the Word
- Petitions
- Multiple ceremony sections
- Closing

---

## Implementation

### Builder Functions Location

All builder functions are located in:
```
src/lib/content-builders/shared/builders/
├── index.ts              # Exports all builders
├── cover-page.ts         # Cover/summary pages
├── reading.ts            # Reading sections
├── psalm.ts              # Psalm sections
├── petitions.ts          # Petitions sections
├── ceremony.ts           # Ceremony sections (+ helpers)
└── README.md             # Complete usage documentation
```

### Template Structure

Each module has templates that use these builders:

```
src/lib/content-builders/[module]/templates/
├── full-script-english.ts   # Full liturgy in English
├── full-script-spanish.ts   # Full liturgy in Spanish
├── summary-english.ts       # Summary/cover page only (if applicable)
└── summary-spanish.ts       # Summary in Spanish (if applicable)
```

### Example Template

```typescript
import {
  buildCoverPage,
  buildReadingSection,
  buildPsalmSection,
  buildPetitionsSection,
  buildCeremonySection,
} from '@/lib/content-builders/shared/builders'

export function buildWeddingLiturgy(wedding: WeddingWithRelations): LiturgyDocument {
  const sections: ContentSection[] = []

  // 1. Cover Page
  sections.push(buildCoverPage({
    title: 'Wedding Celebration',
    subtitle: getWeddingSubtitle(wedding),
    sections: [
      // Cover page sections
    ]
  }))

  // 2. First Reading
  if (wedding.first_reading) {
    sections.push(buildReadingSection({
      readingType: 'First Reading',
      reading: wedding.first_reading,
      readerName: formatPersonName(wedding.first_reading_reader)
    }))
  }

  // 3. Psalm (if not sung)
  if (wedding.psalm && !wedding.psalm_sung) {
    sections.push(buildPsalmSection({
      psalm: wedding.psalm,
      readerName: formatPersonName(wedding.psalm_reader)
    }))
  }

  // 4. Second Reading
  if (wedding.second_reading) {
    sections.push(buildReadingSection({
      readingType: 'Second Reading',
      reading: wedding.second_reading,
      readerName: formatPersonName(wedding.second_reading_reader)
    }))
  }

  // 5. Gospel
  if (wedding.gospel) {
    sections.push(buildReadingSection({
      readingType: 'Gospel',
      reading: wedding.gospel,
      readerName: 'Gospel' // Gospel never has a lay reader
    }))
  }

  // 6. Petitions
  if (wedding.petitions) {
    sections.push(buildPetitionsFromArray({
      petitions: wedding.petitions,
      readerName: formatPersonName(wedding.petitions_reader)
    }))
  }

  // 7. Ceremony sections
  sections.push(buildCeremonySection({
    title: 'Marriage Consent',
    elements: [
      // Ceremony elements
    ]
  }))

  // Set page breaks (all except last)
  sections.forEach((section, index) => {
    section.pageBreakAfter = index < sections.length - 1
  })

  return {
    sections,
    metadata: {
      title: getWeddingPageTitle(wedding),
      language: 'en'
    }
  }
}
```

---

## Summary

This structure ensures:

1. **Consistency** - All liturgical scripts follow the same pattern
2. **Clarity** - Clear sections for different parts of the liturgy
3. **Flexibility** - Ceremony sections can accommodate any ritual
4. **Print-friendly** - Proper page breaks for physical binders
5. **Maintainability** - Shared builders reduce code duplication

**For detailed builder usage, see:**
- [LITURGICAL_SCRIPT_SYSTEM.md](./LITURGICAL_SCRIPT_SYSTEM.md) - Complete system documentation
- `src/lib/content-builders/shared/builders/README.md` - Builder API reference
- [CONTENT_BUILDER_SECTIONS.md](./CONTENT_BUILDER_SECTIONS.md) - Section type interfaces
- [DEFINITIONS.md](./DEFINITIONS.md) - Liturgical terminology

**For implementation examples, see:**
- Wedding templates: `src/lib/content-builders/wedding/templates/`
- Funeral templates: `src/lib/content-builders/funeral/templates/`
- Mass templates: `src/lib/content-builders/mass/templates/`
