# Person Formatters

**Location:** `src/lib/utils/formatters.ts`

This document describes all person-related formatting functions used throughout the application.

---

## Table of Contents

- [Overview](#overview)
- [Critical Rules](#critical-rules)
- [Database-Generated Fields](#database-generated-fields)
- [Name Formatters](#name-formatters)
- [Contact Formatters](#contact-formatters)
- [Pronunciation Formatters](#pronunciation-formatters)
- [Role Formatters](#role-formatters)
- [Related Documentation](#related-documentation)

---

## Overview

**Purpose:**
- Ensure consistent person name formatting across the application
- Leverage database-generated full_name fields
- Provide pronunciation guidance for liturgical ceremonies
- Support contact information display

**Key Principles:**
- Use database-generated `full_name` field instead of manual concatenation
- Handle null/undefined values gracefully
- Support pronunciation fields for liturgical ceremonies
- Combine name with contact info or roles when needed

---

## Critical Rules

### üî¥ IMPORTANT: Use `person.full_name` Directly

**The `people` table has database-generated `full_name` and `full_name_pronunciation` columns.** Always use these fields directly instead of manually concatenating.

```typescript
// ‚úÖ CORRECT - Use database-generated fields
const name = person.full_name
const pronunciation = person.full_name_pronunciation
const nameOrEmpty = person?.full_name || ''

// ‚ùå WRONG - Don't concatenate manually
const name = `${person.first_name} ${person.last_name}`
const pronunciation = `${person.first_name_pronunciation} ${person.last_name_pronunciation}`
```

**Why:**
- `full_name` is auto-generated by the database: `first_name || ' ' || last_name`
- `full_name_pronunciation` is auto-generated: `COALESCE(first_name_pronunciation, first_name) || ' ' || COALESCE(last_name_pronunciation, last_name)`
- Always available on the `Person` type
- Consistent across the entire application
- No helper function needed

**Migration:** `supabase/migrations/20251031000001_create_people_table.sql`

---

## Database-Generated Fields

### full_name

**Database-generated field:** `first_name || ' ' || last_name`

**Usage:**
```typescript
// Direct access (preferred)
const name = person.full_name  // "John Smith"

// With optional chaining
const name = person?.full_name || ''  // "" if person is null
```

**Available on all Person objects from the database.**

### full_name_pronunciation

**Database-generated field:** `COALESCE(first_name_pronunciation, first_name) || ' ' || COALESCE(last_name_pronunciation, last_name)`

**Usage:**
```typescript
// Direct access
const pronunciation = person.full_name_pronunciation  // "jawn smith" or "John Smith"

// With optional chaining
const pronunciation = person?.full_name_pronunciation || ''
```

**Pronunciation Fields:**
- `first_name_pronunciation` - Optional pronunciation guide for first name
- `last_name_pronunciation` - Optional pronunciation guide for last name
- `full_name_pronunciation` - Auto-generated, falls back to actual name if pronunciation not provided

**Available on all Person objects from the database.**

---

## Name Formatters

### formatPersonLastName()

Returns last name only: **"Smith"**

```typescript
import { formatPersonLastName } from '@/lib/utils/formatters'

formatPersonLastName(person)  // "Smith"
formatPersonLastName(null)    // ""
```

**Use for:** When only last name is needed (titles, summaries)

### formatPersonFirstName()

Returns first name only: **"John"**

```typescript
import { formatPersonFirstName } from '@/lib/utils/formatters'

formatPersonFirstName(person)  // "John"
formatPersonFirstName(null)    // ""
```

**Use for:** Informal displays, casual references

---

## Contact Formatters

### formatPersonWithPhone()

Returns name with phone: **"John Smith ‚Äî 555-1234"**

Uses database-generated `full_name` field.

```typescript
import { formatPersonWithPhone } from '@/lib/utils/formatters'

formatPersonWithPhone(person)  // "John Smith ‚Äî 555-1234"
formatPersonWithPhone(person)  // "John Smith" (no phone)
```

**Use for:** Contact lists, forms with phone display, general person displays (coordinators, presiders, readers, family contacts, etc.)

### formatPersonWithEmail()

Returns name with email: **"John Smith - john@example.com"**

Uses database-generated `full_name` field.

```typescript
import { formatPersonWithEmail } from '@/lib/utils/formatters'

formatPersonWithEmail(person)  // "John Smith - john@example.com"
formatPersonWithEmail({ ...person, email: null })  // "John Smith"
```

**Use for:** Contact lists with email, participant communications

---

## Pronunciation Formatters

### formatPersonWithPronunciation()

Returns name with pronunciation: **"John Smith (jawn smith)"**

Uses database-generated `full_name` and `full_name_pronunciation` fields.

```typescript
import { formatPersonWithPronunciation } from '@/lib/utils/formatters'

formatPersonWithPronunciation(person)  // "John Smith (jawn smith)" (with pronunciation)
formatPersonWithPronunciation(person)  // "John Smith" (no pronunciation)
```

**Use for:** Primary participants in liturgical ceremonies where pronunciation guidance helps presiders (liturgy document titles and ceremony scripts):
- Wedding: bride and groom (in title functions)
- Funeral: deceased (in title functions and ceremony scripts)
- Baptism: child (in ceremony scripts)
- Quincea√±era: quincea√±era (in title functions and ceremony scripts)
- Presentation: child (in ceremony scripts)

**Note:** Pronunciation is only shown if it differs from the person's actual name. If `full_name_pronunciation` equals `full_name`, pronunciation is omitted.

### formatPersonWithPronunciationWithPhone()

Returns name with pronunciation and phone: **"John Smith (jawn smith) ‚Äî 555-1234"**

Uses database-generated `full_name` and `full_name_pronunciation` fields.

```typescript
import { formatPersonWithPronunciationWithPhone } from '@/lib/utils/formatters'

formatPersonWithPronunciationWithPhone(person)  // "John Smith (jawn smith) ‚Äî 555-1234" (with pronunciation and phone)
formatPersonWithPronunciationWithPhone(person)  // "John Smith (jawn smith)" (pronunciation only, no phone)
formatPersonWithPronunciationWithPhone(person)  // "John Smith ‚Äî 555-1234" (phone only, no pronunciation)
formatPersonWithPronunciationWithPhone(person)  // "John Smith" (no pronunciation or phone)
```

**Use for:** Primary participants in liturgical ceremonies where pronunciation guidance helps presiders:
- Wedding: bride and groom
- Funeral: deceased
- Baptism: child
- Quincea√±era: quincea√±era
- Presentation: child

**Note:** Pronunciation is only shown if it differs from the person's actual name. If `full_name_pronunciation` equals `full_name`, pronunciation is omitted.

---

## Role Formatters

### formatPersonWithRole()

Returns name with role: **"John Smith (Lector)"**

Uses database-generated `full_name` field.

```typescript
import { formatPersonWithRole } from '@/lib/utils/formatters'

formatPersonWithRole(person, 'Lector')     // "John Smith (Lector)"
formatPersonWithRole(person, 'Best Man')   // "John Smith (Best Man)"
formatPersonWithRole(person, null)         // "John Smith"
```

**Use for:** Liturgical roles, ministry assignments, participant lists

---

## Related Documentation

- [Date & Time Formatters](./DATE_TIME_FORMATTERS.md) - Date and time formatting
- [Entity Formatters](./ENTITY_FORMATTERS.md) - Event, reading, location formatting
- [Page Title Formatters](./PAGE_TITLE_FORMATTERS.md) - Module-specific title generators
- [Filename Formatters](./FILENAME_FORMATTERS.md) - Export filename generators
- [Main Formatters Index](../FORMATTERS.md) - Complete formatter overview
- [CODE_CONVENTIONS.md](../CODE_CONVENTIONS.md) - General coding standards
